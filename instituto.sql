-- MySQL Script generated by MySQL Workbench
-- Tue Mar 20 15:19:29 2018
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema instituto
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `instituto` ;

-- -----------------------------------------------------
-- Schema instituto
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `instituto` DEFAULT CHARACTER SET utf8 ;
USE `instituto` ;

-- -----------------------------------------------------
-- Table `instituto`.`tutor`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `instituto`.`tutor` ;

CREATE TABLE IF NOT EXISTS `instituto`.`tutor` (
  `dni` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  `telefono` VARCHAR(45) NOT NULL,
  `email` VARCHAR(45) NULL,
  PRIMARY KEY (`dni`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `instituto`.`alumno`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `instituto`.`alumno` ;

CREATE TABLE IF NOT EXISTS `instituto`.`alumno` (
  `apellido` VARCHAR(45) NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `dni` INT NOT NULL,
  `fechaNacimiento` DATE NOT NULL,
  `direccion` VARCHAR(45) NOT NULL,
  `email` VARCHAR(45) NULL,
  `tutor_dni` INT NOT NULL,
  PRIMARY KEY (`dni`, `tutor_dni`),
  UNIQUE INDEX `dni_UNIQUE` (`dni` ASC),
  INDEX `fk_alumno_tutor1_idx` (`tutor_dni` ASC),
  CONSTRAINT `fk_alumno_tutor1`
    FOREIGN KEY (`tutor_dni`)
    REFERENCES `instituto`.`tutor` (`dni`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `instituto`.`curso`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `instituto`.`curso` ;

CREATE TABLE IF NOT EXISTS `instituto`.`curso` (
  `idcurso` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `anio` INT NOT NULL,
  PRIMARY KEY (`idcurso`),
  UNIQUE INDEX `idcurso_UNIQUE` (`idcurso` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `instituto`.`alumnoxcurso`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `instituto`.`alumnoxcurso` ;

CREATE TABLE IF NOT EXISTS `instituto`.`alumnoxcurso` (
  `alumno_dni` INT NOT NULL,
  `curso_idcurso` INT NOT NULL,
  `anio` INT NOT NULL,
  PRIMARY KEY (`alumno_dni`, `curso_idcurso`),
  INDEX `fk_alumno_has_curso_curso1_idx` (`curso_idcurso` ASC),
  INDEX `fk_alumno_has_curso_alumno_idx` (`alumno_dni` ASC),
  CONSTRAINT `fk_alumno_has_curso_alumno`
    FOREIGN KEY (`alumno_dni`)
    REFERENCES `instituto`.`alumno` (`dni`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_alumno_has_curso_curso1`
    FOREIGN KEY (`curso_idcurso`)
    REFERENCES `instituto`.`curso` (`idcurso`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `instituto`.`asistencia`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `instituto`.`asistencia` ;

CREATE TABLE IF NOT EXISTS `instituto`.`asistencia` (
  `idasistencia` INT NOT NULL AUTO_INCREMENT,
  `fecha` DATE NOT NULL,
  `tipo` ENUM('clase', 'edFisica', 'clase+edFisica') NOT NULL,
  `valor` ENUM('1', '1/2') NOT NULL,
  `alumnoxcurso_alumno_dni` INT NOT NULL,
  `alumnoxcurso_curso_idcurso` INT NOT NULL,
  `justificada` TINYINT(2) NOT NULL,
  PRIMARY KEY (`idasistencia`, `alumnoxcurso_alumno_dni`, `alumnoxcurso_curso_idcurso`),
  UNIQUE INDEX `idasistencia_UNIQUE` (`idasistencia` ASC),
  INDEX `fk_asistencia_alumnoxcurso1_idx` (`alumnoxcurso_alumno_dni` ASC, `alumnoxcurso_curso_idcurso` ASC),
  CONSTRAINT `fk_asistencia_alumnoxcurso1`
    FOREIGN KEY (`alumnoxcurso_alumno_dni` , `alumnoxcurso_curso_idcurso`)
    REFERENCES `instituto`.`alumnoxcurso` (`alumno_dni` , `curso_idcurso`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `instituto`.`preceptor`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `instituto`.`preceptor` ;

CREATE TABLE IF NOT EXISTS `instituto`.`preceptor` (
  `dni` INT NOT NULL,
  `nombre` VARCHAR(45) NOT NULL,
  `apellido` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`dni`))
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;



INSERT INTO `curso` (`idcurso`, `nombre`, `anio`) VALUES
(0, 'A', 1),
(1, 'B', 1),
(2, 'A', 2),
(3, 'B', 2),
(4, 'A', 3),
(5, 'B', 3);

INSERT INTO `tutor` (`dni`, `nombre`, `apellido`, `telefono`, `email`) VALUES
(29654213, 'tutor1', 'apellidotutor', '15656565', 'email');

INSERT INTO `alumno` (`apellido`, `nombre`, `dni`, `fechaNacimiento`, `direccion`, `email`, `tutor_dni`) VALUES
('apellido', 'nombre', 24987654, '1993-01-22', 'calle', 'email', 29654213),
('Galvez', 'Juan Ignacio', 37865412, '1996-03-13', 'calle 11', 'email', 29654213),
('morales', 'alexis', 39271623, '1995-03-15', 'calle 12', 'email', 29654213),
('Alvarez Scasic', 'Juan', 39282123, '1996-02-13', 'calle 11', 'email', 29654213),
('Hernandez Scasic', 'Agustin', 39764123, '1995-02-13', 'calle 11', 'email', 29654213);

INSERT INTO `alumnoxcurso` (`alumno_dni`, `curso_idcurso`, `anio`) VALUES
(24987654, 1, 2018),
(37865412, 1, 2018),
(39271623, 1, 2018),
(39282123, 1, 2018),
(39764123, 5, 2018);

INSERT INTO `asistencia` (`idasistencia`, `fecha`, `tipo`, `valor`, `alumnoxcurso_alumno_dni`, `alumnoxcurso_curso_idcurso`, `justificada`) VALUES
(94, '2018-03-18', 'clase+edfisica', '1', 37865412, 1, 1),
(95, '2018-03-18', 'edFisica', '1/2', 39271623, 1, 1),
(96, '2018-03-18', 'clase', '1/2', 39282123, 1, 1),
(97, '2018-03-18', 'clase', '1', 24987654, 1, 1),
(98, '2018-03-18', 'clase', '1', 37865412, 1, 1),
(99, '2018-03-18', 'clase', '1', 39271623, 1, 1),
(100, '2018-03-18', 'clase', '1', 39282123, 1, 1),
(101, '2018-03-19', 'clase', '1', 24987654, 1, 1),
(102, '2018-03-19', 'clase', '1', 37865412, 1, 1),
(103, '2018-03-19', 'clase', '1', 39271623, 1, 1),
(104, '2018-03-19', 'clase', '1', 39282123, 1, 1);


